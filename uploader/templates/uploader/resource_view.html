{% extends 'uploader/base.html' %}
{% load url from future %}
{% load static %}
{% block body_block %}
<script>
function vote(resourceID, rating)
{
    var xmlHttp = null;
    theUrl = '/uploader/rate/' + resourceID + '/' + rating + '/';
    xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false );
    xmlHttp.send( null );
    $('#rating').hide();
    $('#thankyou').show();
    return xmlHttp.responseText;
}
    
</script>
<!-- FIXME all this sucky conditional stuff should be in the view -->
<h2>
    {% if resource.file %}
        {{ resource.file.title }}
    {% else %}
        {{ resource.bookmark.title }}
    {% endif %}
</h2>
<div id="resource_details">
    <div id="syllabus">Suitable for: 
    <strong>{{ resource.syllabus }}
    {% if resource.unit %} > {{ resource.unit }}{% endif %}
    {% if resource.unit_topic %} > {{ resource.unit_topic }}{% endif %}
    </strong>
    </div>
    <div id="rating">
        <a href="javascript:none" onclick="javascript:vote({{ resource.id}}, 5)">
            {% if rating_val > 4.9 %}
                <span>★</span>
            {% else %}
                <span>☆</span>
            {% endif %}
        </a>
        <a href="javascript:none" onclick="javascript:vote({{ resource.id}}, 4)">
            {% if rating_val >= 4 %}
                <span>★</span>
            {% else %}
                <span>☆</span>
            {% endif %}
        </a>
        <a href="javascript:none" onclick="javascript:vote({{ resource.id}}, 3)">
            {% if rating_val >= 3 %}
                <span>★</span>
            {% else %}
                <span>☆</span>
            {% endif %}
        </a>
        <a href="javascript:none" onclick="javascript:vote({{ resource.id}}, 2)">
            {% if rating_val >= 2 %}
                <span>★</span>
            {% else %}
                <span>☆</span>
            {% endif %}
        </a>
        <a href="javascript:none" onclick="javascript:vote({{ resource.id}}, 1)">
            {% if rating_val >= 1 %}
                <span>★</span>
            {% else %}
                <span>☆</span>
            {% endif %}
        </a>
        <div class="rating_value">{{ rating }}</div>
    </div>
    <div id="thankyou" style="display:none">
        Thank you for rating.
    </div>
    <div id="uploader" style="clear:both;">
        {% if resource.file %}
            {{ resource.file.uploader }}
        {% else %}
            {{ resource.bookmark.uploader }}
        {% endif %}
    </div>
    <div id="topics">
        {% if resource.topics.all %}
        <p>Topics: 
            {% for topic in resource.topics.all %}
                {% if not forloop.first %}
                {% if forloop.last %} &amp; {% else %}, {% endif %}
                {% endif %}
                <strong>{{ topic }}</strong>
            {% endfor %}
        </p>
        {% endif %}
    </div>
</div>
<!--<hr />-->
<div id="description">
    {% if resource.file %}
        {{ resource.file.description }}
    {% else %}
        {{ resource.bookmark.description }}
    {% endif %}
</div>

{% if resource.file %}
    <div id="author">Resource created by 
        {% if resource.file.author == '' %}
        <a href="{{ resource.file.author_link }}">
            {{ resource.file.uploader }}
        </a>
        {% else %}
        <a href="{{ resource.file.author_link }}">
            {{ resource.file.author }}</a>{% endif %}, published under 
        <a href="{{ resource.licence.link }}">
            {{ resource.file.licence }} licence
        </a>
    </div>
{% endif %}
<div id="published">Uploaded {{ resource.pub_date }}</div>

<div class="action">
    {% if resource.file %}
    <a href='{{ MEDIA_URL }}{{ resource.file.file }}'>Download</a>
    {% else %}
        <div id="link">
            <a href='{{ resource.bookmark.link }}'>Open link</a>
        </div>
    {% endif %}
</div>
{% endblock %}
